<project name="PyInstaller builder" default="py_installer.help">
	
	<taskdef resource="net/sf/antcontrib/antlib.xml" />
	
	<!-- stable version -->
	<!--
	<property name="win-pyinstaller-path"
	            location="../../../../python/pyinstaller-2.0"/>
	-->

	<!-- development version but better behaviour -->
	<property name="win-pyinstaller-path"
	            location="../../../../python/pyinstaller-pyinstaller-d437018"/>	
	
	
	<property name="python-path"
	            location="../../../../python/python_32/Python27"/>	

	<property name="py_med.src.path"
				location="src"/>
	
	<property name="py_med.spec.path"
				location="spec"/>	
	
	<property name="py_med.start.script"
				location="src/med/programs/console/test_poincare.py"/>
	
	<target name="properties.environment">
		<!--
		<property environment="env"/>
		-->
		<echo message="ENV: ${os.name}"/>
	</target>	
	
	<target name="build.application">
		<exec executable="/bin/bash" os="Linux">
			<arg value="mvn" />
			<arg value="assembly:directory" />
		</exec>
		
		<!--
${python-path}/python.exe ${win-pyinstaller-path}/pyinstaller.py ${py_med.start.script} -F -p ${py_med.src.path} -o ${py_med.spec.path} -n PyMed -c -y		
		-->
		<delete dir="${py_med.spec.path}"/>
		<if>
			<equals arg1="${os.name}" arg2="Windows Vista"/>
		    <then>
		    	<echo>
		    		Creating build.bat
				</echo>
				<echo file="build.bat">
${python-path}/python.exe ${win-pyinstaller-path}/pyinstaller.py ${startup.script} -F -p ${py_med.src.path} -o ${py_med.spec.path} -n ${application.name} ${application.type} -y
				</echo>
				<exec executable="cmd" os="Windows Vista">
					<arg value="/c" />
					<arg value="build.bat" />			
				</exec>		    	
			</then>
			<!--
			<else>
				<echo>Can't create build.bat !!!</echo>
			</else>
			-->
		</if>
	</target>	

	<target name="build.py_med.test_poincare">
		<antcall target="build.application">
		    <param name="startup.script" value="src/med/programs/console/test_poincare.py"/>
		    <param name="application.name" value="PyMed"/>
			<param name="application.type" value="-c" />
			<param name="py_med.spec.path" value="spec" />
		</antcall>
	</target>
	
	<target name="build.py_med.test_QT">
		<antcall target="build.application">
		    <param name="startup.script" value="src/med/programs/gui/test_QT.pyw"/>
		    <param name="application.name" value="PyMedQT"/>
			<param name="application.type" value="-w" />
			<param name="py_med.spec.path" value="spec_QT" />
		</antcall>
	</target>	
	
	<target name="py_installer.help">
		<exec executable="/bin/bash" os="Linux">
			<arg value="mvn" />
			<arg value="assembly:directory" />
		</exec>
		<exec executable="cmd" os="Windows Vista">
			<arg value="/c" />
			<arg value="${python-path}/python.exe" />			
			<arg value="${win-pyinstaller-path}/pyinstaller.py" />
			<arg value="--help" />
		</exec>		
	</target>
	

</project>
